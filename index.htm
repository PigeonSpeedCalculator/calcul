<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Professional Simulation Engine</title>
<link rel="stylesheet"
href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body{margin:0;background:#0b1220;color:white;font-family:tahoma}
#map{height:65vh}
.panel{padding:10px;background:#111a2f;display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
input,button{padding:6px;background:#1c2745;color:white;border:none}
button{background:#0ea5e9;cursor:pointer}
.stats{padding:10px;background:#0f172a}
</style>
</head>
<body>

<div id="map"></div>

<div class="panel">
<input id="lat" placeholder="Latitude">
<input id="lng" placeholder="Longitude">
<input id="destLat" placeholder="Dest Latitude">
<input id="destLng" placeholder="Dest Longitude">
<button onclick="start()">Start</button>
</div>

<div class="stats" id="stats"></div>

<script>

const map = L.map('map').setView([33.5,-7.6],7);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
.addTo(map);

let worker = new Worker("physics.worker.js");

let pigeonMarker = null;
let pathLine = null;

worker.onmessage = (e)=>{

const data = e.data;

if(data.type==="path"){
pathLine = L.polyline(data.path,{color:"cyan"}).addTo(map);
map.fitBounds(data.path);
}

if(data.type==="update"){

if(!pigeonMarker){
pigeonMarker = L.circleMarker(data.pos,{radius:6}).addTo(map);
}else{
pigeonMarker.setLatLng(data.pos);
}

document.getElementById("stats").innerHTML =
`
السرعة: ${data.speed.toFixed(2)} m/s<br>
الطاقة: ${data.energy.toFixed(1)} %<br>
الارتفاع: ${data.elev.toFixed(0)} m
`;

}
};

function start(){

const start = {
lat:parseFloat(lat.value),
lng:parseFloat(lng.value)
};

const end = {
lat:parseFloat(destLat.value),
lng:parseFloat(destLng.value)
};

worker.postMessage({
type:"init",
start,
end
});

}

</script>
</body>
</html>
